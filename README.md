#### Простая организация глобального модуля расчёта стоимости доставки разными ТК для MS2

Что мы можем при таком подходе?   
Например можно легко реализовать такие требования (примеры реальные):   

* не ограниченное количество служб доставки (я использую одновременно ДЛ, СДЭК, почту, ИМЛ, ПЭК)
* в зависимости от суммы заказа или веса/габаритов использовать разные службы доставки или только определённые способы
* Включить сегодня вместо СДЭКа Деловые линии, а на следующий месяц вернуть СДЭК
* если в корзине есть некий товар - исключить доставку почтой РФ
* добавить наценку для доставки куда-то или для какого-то товара

Ну и т.д. + отдаём любые комментарии на фронт.   

1.  Создаём свой класс-обработчик для доставок. Например, тут: msDeliveryHandlerGlobal,
core/components/minishop2/custom/delivery/msdeliveryhandler_global.class.php.  
Назначаем его доставкам: [скрин](https://prntscr.com/ihnsju)

Здесь мы переопределяем стандартный метод msDeliveryHandler таким образом, чтобы иметь возможность делать нужные проверки (см. массив $orderData) и передавать расчёт доставки в свой класс (тут: $DC->run();).
В случае, если нас что-то не устраивает в переданных с фронта данных — отдаём cost = -1 — это маркер для вывода на фронте сообщения об ошибке.

2. Создаём свой класс-обработчик для доставок. Например, тут: artlOrderHandler,
core/components/minishop2/custom/order/msorderhandlerCustom.class.php.
Назначаем его доставкам: [скрин](https://prntscr.com/iho3lp)    
Тут у нас переопределён метод getCost() для вывода ошибок:
```
if($deliveryData['cost'] == -1) {
        return $this->error($deliveryData['message'], array('requires' => $deliveryData['requires']));
}
```  
3.  Создаём свой класс, кладём куда угодно (в рамках core), например я создаю категорию core/ext, где храню дополнительные классы.
В этом примере пункты выдачи СДЭК хранятся в отдельной таблицу _sdek_cities; обновляются cron'ом раз в неделю — чтобы не запрашивать их у СДЭКа при каждом расчёте.

**Внимание! Указанный класс — это просто сокращённый и подчищенный пример, не стоит рассчитывать, что он сразу у вас заработает, нужные методы пишем сами. Смотрите, что отдаёт response в консоли и настраивайте вывод на фронте как удобно.**
